# -----------------------------------------------------------------------------
# Production OVERRIDES only — this file is merged WITH docker-compose.yml.
# -----------------------------------------------------------------------------
# The full stack (db, neo4j, redis, meilisearch, minio, ollama, api, web, nginx,
# backup-full) is defined in docker-compose.yml. This file only changes what
# differs in production; nothing is "missing" — both files are used together.
#
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#
# What this file overrides:
#   - nginx: use SSL config and ssl/ volume (HTTPS)
#   - minio: no published ports (security; images via API only)
#   - redis: optional override for maxmemory in prod (compose.yml already sets it)
# -----------------------------------------------------------------------------

services:
  redis:
    command: redis-server --maxmemory ${REDIS_MAXMEMORY:-512mb} --maxmemory-policy ${REDIS_MAXMEMORY_POLICY:-allkeys-lru}

  nginx:
    volumes:
      - ./nginx-ssl.conf:/etc/nginx/conf.d/default.conf:ro
      - ./ssl:/etc/nginx/ssl:ro

  # MinIO: no published ports in prod. Images served via API (GET /images/:key).
  minio:
    ports: []
