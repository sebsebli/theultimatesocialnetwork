POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
NEO4J_PASSWORD=password
MEILI_MASTER_KEY=masterKey
# Reindex Meilisearch from Postgres on API startup (true = always reindex; false = only when posts index is empty)
MEILISEARCH_REINDEX_ON_STARTUP=true
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# Redis (required: queue, cache, throttling). 16GB server: 2GB for Redis.
REDIS_URL=redis://redis:6379
REDIS_MAXMEMORY=2gb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# Ollama (required for moderation and agents). Vision model is pulled at deploy and tested; deployment fails if unavailable.
OLLAMA_HOST=http://ollama:11434
# Text moderation: Ollama model (granite4:latest). No vision model – image moderation uses NSFW detector when MODERATION_IMAGE_SERVICE_URL is set.
OLLAMA_TEXT_MODEL=granite4:latest
# Image moderation: Falconsai/nsfw_image_detection service (ViT). When set, used for image moderation.
MODERATION_IMAGE_SERVICE_URL=http://nsfw-detector:5000

JWT_SECRET=your-jwt-secret-change-in-production
# Dev-only: accept this token in POST /auth/verify (e.g. 123456). Set to match agents CITE_DEV_TOKEN for --resume.
# For local agent --resume with dev token, set NODE_ENV=development so this is accepted.
DEV_TOKEN=123456
# Node Environment (use development for local agent testing so DEV_TOKEN works)
NODE_ENV=production
# Production: 4 CPU / 16GB — cap Node heap so other services have room
NODE_OPTIONS=--max-old-space-size=2048
METRICS_SECRET=your-metrics-secret-change-in-production
HEALTH_SECRET=your-health-secret-change-in-production
ENFORCE_HTTPS=true
# Global API throttle (per-IP). Local deploy uses nginx.local.conf (no Nginx rate limit) for agent/testing.
# For heavy local agent runs, use higher values (e.g. 1000) or keep 60; trusted IPs (localhost, Docker) skip throttle.
THROTTLE_LIMIT=60
THROTTLE_TTL_MS=60000
BODY_LIMIT=1mb
OLLAMA_CHAT_TIMEOUT_MS=8000
OLLAMA_IMAGE_TIMEOUT_MS=15000
MODERATION_MIN_SIMILAR_COUNT=2
MODERATION_SIMILARITY_THRESHOLD=0.92
MODERATION_MAX_RECENT_ITEMS=10
MODERATION_SIMHASH_HAMMING_MAX=3
MODERATION_SIMHASH_CACHE_SIZE=20
# API Configuration (only nginx exposed; app at http://localhost)
FRONTEND_URL=http://localhost
NEXT_PUBLIC_API_URL=http://localhost/api
# Beta (invitation-only) mode: set to true/false to override DB. Omit to use system_settings BETA_MODE row.
# BETA_MODE=true
# Required when NODE_ENV=production: comma-separated allowed CORS origins (add LAN IP + Expo for phone testing)
CORS_ORIGINS=http://localhost,http://192.168.68.112,exp://192.168.68.112:8081,http://192.168.0.79,exp://192.168.0.79:8081
MEILISEARCH_REINDEX_ON_STARTUP=true
# Async moderation for scale: store/queue first, moderate in workers (set true for thousands of users/uploaders)
MODERATION_IMAGE_ASYNC=true
MODERATION_CONTENT_ASYNC=true

CERTBOT_EMAIL=hello@citewalk.com
CERTBOT_DOMAIN=citewalk.com
CERTBOT_STAGING=1   # set to 1 to use Let's Encrypt staging (avoid rate limits during testing)

# Admin: generate invite codes, agent seed/token (X-Admin-Key header). Must match agents/.env CITE_ADMIN_SECRET.
# Example: curl -X POST http://localhost/api/admin/invites/generate-code -H "X-Admin-Key: YOUR_SECRET"
CITEWALK_ADMIN_SECRET=your-admin-secret-change-in-production

# SMTP Email Configuration (Brevo)
SMTP_HOST=smtp-relay.brevo.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-smtp-user@smtp-brevo.com
SMTP_PASS=your-brevo-smtp-api-key
SMTP_FROM="Citewalk <noreply@citewalk.com>"