# =============================================================================
# CITE Docker stack — copy to .env and fill in your values.
# Used by: docker-compose (env_file). API also gets REDIS_URL, OLLAMA_HOST
# from compose environment; listing them here keeps .env complete and documents
# what the stack needs.
# =============================================================================

# -----------------------------------------------------------------------------
# Database (Postgres)
# -----------------------------------------------------------------------------
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

# -----------------------------------------------------------------------------
# Neo4j
# -----------------------------------------------------------------------------
NEO4J_PASSWORD=password

# -----------------------------------------------------------------------------
# Meilisearch
# -----------------------------------------------------------------------------
MEILI_MASTER_KEY=masterKey

# -----------------------------------------------------------------------------
# MinIO (object storage)
# -----------------------------------------------------------------------------
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# -----------------------------------------------------------------------------
# Redis (required: queue, cache, throttling, feed cache)
# Compose also sets REDIS_URL for the API; put it here so .env is complete.
# -----------------------------------------------------------------------------
REDIS_URL=redis://redis:6379
# Optional: limit memory so Redis does not grow unbounded (Compose default: 256mb dev, 512mb prod)
# REDIS_MAXMEMORY=256mb
# REDIS_MAXMEMORY_POLICY=allkeys-lru

# -----------------------------------------------------------------------------
# Ollama (required for content moderation)
# Compose also sets OLLAMA_HOST for the API; put it here so .env is complete.
# -----------------------------------------------------------------------------
OLLAMA_HOST=http://ollama:11434

# -----------------------------------------------------------------------------
# JWT / Auth (required — change in production)
# -----------------------------------------------------------------------------
JWT_SECRET=your-secret-key-change-in-production

# -----------------------------------------------------------------------------
# Node environment
# -----------------------------------------------------------------------------
NODE_ENV=production

# -----------------------------------------------------------------------------
# Metrics (optional): when set, GET /metrics requires X-Metrics-Secret or Bearer
# -----------------------------------------------------------------------------
# METRICS_SECRET=your-metrics-secret

# -----------------------------------------------------------------------------
# Health (optional): when set, full GET /health (DB/Redis) requires X-Health-Secret or private IP
# External LB should use GET /health/live for liveness.
# -----------------------------------------------------------------------------
# HEALTH_SECRET=your-health-secret

# -----------------------------------------------------------------------------
# HTTPS (production): when ENFORCE_HTTPS=true, API returns 403 if X-Forwarded-Proto is not https
# Set when behind nginx or another TLS-terminating proxy.
# -----------------------------------------------------------------------------
# ENFORCE_HTTPS=true

# -----------------------------------------------------------------------------
# Global throttle: requests per IP per window (default 60/min for abuse mitigation)
# -----------------------------------------------------------------------------
# THROTTLE_LIMIT=60
# THROTTLE_TTL_MS=60000

# -----------------------------------------------------------------------------
# Request body size limit (DoS prevention; default 1mb)
# -----------------------------------------------------------------------------
# BODY_LIMIT=1mb

# -----------------------------------------------------------------------------
# Content moderation (optional): Ollama timeouts and similarity thresholds
# -----------------------------------------------------------------------------
# OLLAMA_CHAT_TIMEOUT_MS=8000
# OLLAMA_IMAGE_TIMEOUT_MS=15000
# MODERATION_MIN_SIMILAR_COUNT=2
# MODERATION_SIMILARITY_THRESHOLD=0.92
# MODERATION_MAX_RECENT_ITEMS=10
# MODERATION_SIMHASH_HAMMING_MAX=3
# MODERATION_SIMHASH_CACHE_SIZE=20

# -----------------------------------------------------------------------------
# Dev token (optional): for web app dev login bypass
# -----------------------------------------------------------------------------
# DEV_TOKEN=

# -----------------------------------------------------------------------------
# Beta mode (Docker default: on = invite-only). Set to false to open signup.
# -----------------------------------------------------------------------------
# NEXT_PUBLIC_BETA_ACTIVE=true   # Docker default: closed beta on. Set false to open.

# -----------------------------------------------------------------------------
# API / Frontend URLs (use HTTPS in production). With Docker, only nginx is exposed.
# -----------------------------------------------------------------------------
FRONTEND_URL=http://localhost
NEXT_PUBLIC_API_URL=http://localhost/api
# Production: comma-separated allowed origins (e.g. https://citewalk.app,https://api.citewalk.app)
# CORS_ORIGINS=https://yourdomain.com,https://api.yourdomain.com

# -----------------------------------------------------------------------------
# Admin (required in production): X-Admin-Key for invite generation etc.
# -----------------------------------------------------------------------------
CITEWALK_ADMIN_SECRET=dev-admin-change-me

# -----------------------------------------------------------------------------
# Certbot / Let's Encrypt (production: auto SSL + auto renew for citewalk.com)
# Required for ./deploy.sh prod when ssl/cert.pem and ssl/key.pem are missing.
# -----------------------------------------------------------------------------
CERTBOT_EMAIL=hello@citewalk.com
CERTBOT_DOMAIN=citewalk.com
# CERTBOT_STAGING=1   # set to 1 to use Let's Encrypt staging (avoid rate limits during testing)

# -----------------------------------------------------------------------------
# SMTP (Brevo or other)
# -----------------------------------------------------------------------------
SMTP_HOST=smtp-relay.brevo.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=
SMTP_PASS=
SMTP_FROM="Citewalk System <noreply@citewalk.com>"

# -----------------------------------------------------------------------------
# Email legal footer (optional, CAN-SPAM / GDPR)
# -----------------------------------------------------------------------------
# EMAIL_COMPANY_NAME=Cite
# EMAIL_COMPANY_ADDRESS=Your Company, Street, City, Postcode, Country
# EMAIL_PREFERENCES_URL=https://yoursite.com/settings/notifications
